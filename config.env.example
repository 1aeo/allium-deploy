# Allium Metrics Deployment Configuration
# ========================================
# Copy this to config.env and edit the values.
# config.env is gitignored - never commit secrets!

# === STORAGE CONFIGURATION ===
# Storage fetch order: comma-separated list of backends to try in order
# Options: r2, do, failover
# Examples:
#   "r2,do,failover"  - Try R2 first, then DO Spaces, then failover origin
#   "do,r2,failover"  - Try DO Spaces first, then R2, then failover origin
#   "r2,failover"     - R2 only with failover (no DO Spaces)
#   "do,failover"     - DO Spaces only with failover (no R2)
STORAGE_ORDER=r2,do,failover

# === CLOUDFLARE CREDENTIALS (Required) ===

# Cloudflare Account ID (from dashboard URL or R2 overview)
CLOUDFLARE_ACCOUNT_ID=your_account_id_here

# === CLOUDFLARE R2 CONFIGURATION ===
# Required if 'r2' is in STORAGE_ORDER

# Enable R2 storage
R2_ENABLED=true

# R2 API Credentials (R2 → Manage R2 API Tokens → Create)
R2_ACCESS_KEY_ID=your_access_key_here
R2_SECRET_ACCESS_KEY=your_secret_key_here

# R2 bucket name
R2_BUCKET=my-metrics-content

# R2 binding name (used in Worker code: env.METRICS_CONTENT)
R2_BINDING_NAME=METRICS_CONTENT

# === DIGITALOCEAN SPACES CONFIGURATION ===
# Required if 'do' is in STORAGE_ORDER

# Enable DO Spaces storage
DO_ENABLED=false

# DO Spaces API Credentials (API → Spaces Keys → Generate New Key)
DO_SPACES_KEY=your_spaces_access_key_here
DO_SPACES_SECRET=your_spaces_secret_key_here

# DO Spaces region (nyc3, sfo3, ams3, sgp1, fra1)
DO_SPACES_REGION=nyc3

# DO Spaces bucket name
DO_SPACES_BUCKET=my-metrics-content

# DO Spaces CDN toggle (true = use CDN, false = use origin)
# CDN is faster but has ~1hr cache (no purge available)
# Origin is slower but always serves fresh content
DO_SPACES_CDN=false

# DO Spaces URL for Pages function
# This is auto-generated based on bucket/region, but you can override it
# Origin: https://{bucket}.{region}.digitaloceanspaces.com
# CDN:    https://{bucket}.{region}.cdn.digitaloceanspaces.com
DO_SPACES_URL=https://my-metrics-content.nyc3.digitaloceanspaces.com

# === CLOUDFLARE PAGES CONFIGURATION ===

# Pages project name (as shown in Cloudflare dashboard)
PAGES_PROJECT_NAME=my-metrics

# Wrangler compatibility date (YYYY-MM-DD)
WRANGLER_COMPATIBILITY_DATE=2025-12-01

# Pages build output directory
PAGES_BUILD_OUTPUT_DIR=public

# Site URL (for allium --base-url and Cloudflare CDN cache purge)
SITE_URL=https://metrics.example.com

# === LOCAL PATHS ===

# Output directory for generated metrics
OUTPUT_DIR=$HOME/metrics-output

# Local backup directory
BACKUP_DIR=$HOME/metrics-backups

# Path to allium source
ALLIUM_DIR=$HOME/allium

# Path to rclone binary
RCLONE_PATH=$HOME/bin/rclone

# === SETTINGS ===

# Number of backups to keep
KEEP_BACKUPS=10

# Cron schedule (default: 15 and 45 past each hour)
CRON_SCHEDULE="15,45 * * * *"

# Rclone Performance Tuning - R2 (high parallelism, no rate limiting)
RCLONE_TRANSFERS=128
RCLONE_CHECKERS=256
RCLONE_BUFFER_SIZE=128M
RCLONE_S3_UPLOAD_CONCURRENCY=32
RCLONE_S3_CHUNK_SIZE=16M

# Rclone Performance Tuning - DO Spaces (lower parallelism to avoid 503 rate limiting)
# DO Spaces limits: 240 HEAD/sec, 150 PUT/sec, 750 total/sec per IP
DO_RCLONE_TRANSFERS=56
DO_RCLONE_CHECKERS=80

# === BACKUP SETTINGS ===
# Daily backups: creates one backup per day to reduce redundant operations

DAILY_LOCAL_BACKUP=true
DAILY_R2_BACKUP=true
DAILY_DO_BACKUP=true

# === FAILOVER CONFIGURATION ===
# Required if 'failover' is in STORAGE_ORDER
# Failover to an alternate origin if all storage backends fail

# Base URL for failover origin (e.g., nginx server with same content)
FAILOVER_ORIGIN_URL=

# === CLOUDFLARE CDN CACHE CONFIGURATION ===
# Cloudflare edge caching via the Pages function

# HTML pages: 30 min cache (purged after each upload)
CACHE_TTL_HTML=1800

# Static assets (CSS, JS, images): 24 hour cache
CACHE_TTL_STATIC=86400

# Secret for Cloudflare CDN cache purge endpoint (POST /_purge with X-Purge-Secret header)
PURGE_SECRET=
